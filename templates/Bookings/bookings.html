<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Booking | Falcon Tech World</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-dark: #050505;
            --blue-glow: #3b82f6;
            --orange-glow: #f97316;
            --input-bg: #111111;
        }

        body { background-color: var(--bg-dark); color: white; font-family: 'Outfit', sans-serif; }
        
        .blob { position: fixed; filter: blur(90px); opacity: 0.25; border-radius: 50%; z-index: -1; }
        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: var(--blue-glow); }
        .blob-2 { bottom: -10%; right: -10%; width: 450px; height: 450px; background: var(--orange-glow); }

        .glass-card {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .spec-badge {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 0.75rem;
            border-radius: 16px;
        }

        .input-field {
            background: var(--input-bg);
            border: 1px solid #222;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: var(--blue-glow);
            background: #161616;
            outline: none;
        }

        .brand-gradient {
            background: linear-gradient(to right, #3b82f6, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Hide number input arrows */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
    <style>
    .toast-card {
        animation: slideInRight 0.5s ease forwards;
    }

    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    .fade-out {
        animation: fadeOut 0.5s ease forwards;
    }

    @keyframes fadeOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
</style>
</head>
<body class="py-8 px-4">

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div id="toast-container" class="fixed top-5 right-5 z-[100] space-y-4 min-w-[300px] max-w-md">
    {% if messages %}
        {% for message in messages %}
            <div class="toast-card transform transition-all duration-500 ease-in-out glass-card p-4 rounded-2xl flex items-center shadow-2xl border {% if message.tags == 'success' %}border-green-500/50 bg-green-500/10{% else %}border-red-500/50 bg-red-500/10{% endif %}">
                
                <div class="mr-3">
                    {% if message.tags == 'success' %}
                        <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    {% else %}
                        <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    {% endif %}
                </div>

                <div class="flex-1">
                    <p class="text-sm font-semibold {% if message.tags == 'success' %}text-green-400{% else %}text-red-400{% endif %}">
                        {{ message.tags|title }}
                    </p>
                    <p class="text-xs text-gray-300">{{ message }}</p>
                </div>

                <button onclick="this.parentElement.remove()" class="ml-4 text-gray-500 hover:text-white transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        {% endfor %}
    {% endif %}
</div>



    <div class="max-w-5xl mx-auto">
        <div class="mb-10 text-center">
            <h1 class="text-4xl font-bold mb-3 tracking-tight">Complete Your <span class="brand-gradient">Booking</span></h1>
            <p class="text-gray-400 max-w-md mx-auto">Provide your details to schedule a doorstep technician for your {{ product.brand }} device.</p>
        </div>

        <form method="post" class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            {% csrf_token %}

            <div class="lg:col-span-4 space-y-6">
                <div class="glass-card p-6 rounded-[2rem] sticky top-8">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-orange-500 flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                        </div>
                        <h3 class="font-bold text-lg">Job Details</h3>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="spec-badge">
                            <span class="text-[10px] text-blue-400 font-bold uppercase tracking-wider">Device Type</span>
                            <p class="text-sm mt-1">{{ category_path.0.name }}</p>
                        </div>

                        <div class="spec-badge">
                            <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Brand / Model</span>
                            <p class="text-sm mt-1">{{ product.brand }} {{ product.model_name }}</p>
                        </div>

                        {% if category_path|length > 2 %}
                        <div class="spec-badge">
                            <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Series</span>
                            <p class="text-sm mt-1 text-gray-300">
                                {% for cat in category_path %}{% if forloop.counter0 > 1 %}{{ cat.name }}{% if not forloop.last %} • {% endif %}{% endif %}{% endfor %}
                            </p>
                        </div>
                        {% endif %}

                        <div class="spec-badge bg-orange-500/5 border-orange-500/20">
                            <span class="text-[10px] text-orange-500 font-bold uppercase tracking-wider">Service Type</span>
                            <p class="text-sm mt-1 font-semibold">{{ service|title }}</p>
                        </div>
                    </div>
                    
                    <div class="mt-8 pt-6 border-t border-white/5">
                        <p class="text-[11px] text-gray-500 text-center italic">Service SKU: {{ product.sku }}</p>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-8">
                
                <div class="glass-card p-8 rounded-[2rem]">
                    <div class="flex items-center mb-8">
                        <span class="text-3xl font-bold text-white/10 mr-4">01</span>
                        <h3 class="text-xl font-bold">Contact & Timing</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Phone Number</label>
                            <input type="tel" name="phone" value="{{ user.phone|default:'' }}" required 
                                   class="input-field w-full rounded-2xl p-4 text-white focus:ring-2 focus:ring-blue-500/20" placeholder="e.g. 9876543210">
                        </div>
                       <div class="md:col-span-2 space-y-6">
    <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Appointment Schedule</label>
    
  <div class="md:col-span-2 space-y-6">
    <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Appointment Schedule</label>
    
    <div class="grid grid-cols-1 gap-6">
        <div class="space-y-3">
            <span class="text-[10px] text-blue-400 font-bold uppercase ml-1">1. Choose Date</span>
            <input type="date" id="booking_date" name="booking_date" required 
                   class="input-field w-full rounded-2xl p-4 text-white appearance-none cursor-pointer"
                   style="color-scheme: dark;">
        </div>

        <div class="space-y-3">
            <span class="text-[10px] text-blue-400 font-bold uppercase ml-1">2. Available Slots (10 AM - 10 PM)</span>
            <div id="time-slots-container" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2">
                </div>
            
            <input type="hidden" name="booking_hour" id="selected_hour" required>
        </div>
    </div>
    <p id="time-warning" class="text-[10px] text-orange-500 italic ml-1 hidden">Note: No slots available for the selected date.</p>
</div>
                        <div class="md:col-span-2 space-y-2">
                            <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Problem Description</label>
                            <textarea name="description" rows="3" required 
                                      class="input-field w-full rounded-2xl p-4 text-white" 
                                      placeholder="Describe the issue... (e.g. Blue line on screen, not charging)"></textarea>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-8 rounded-[2rem]">
                    <div class="flex items-center mb-8">
                        <span class="text-3xl font-bold text-white/10 mr-4">02</span>
                        <h3 class="text-xl font-bold">Technician Visit Address</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-1 space-y-2">
                            <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Flat / House No. <span class="text-orange-500">*</span></label>
                            <input type="text" name="house_no" required 
                                   class="input-field w-full rounded-2xl p-4" placeholder="e.g. Flat 402, 4th Floor">
                        </div>
                        
                        <div class="md:col-span-1 space-y-2">
                            <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Building / Apartment <span class="text-orange-500">*</span></label>
                            <input type="text" name="building_name" required 
                                   class="input-field w-full rounded-2xl p-4" placeholder="e.g. Prestige Heights">
                        </div>

                        <div class="md:col-span-2 space-y-2">
                            <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Street Name / Area / Colony <span class="text-orange-500">*</span></label>
                            <input type="text" name="street" required 
                                   class="input-field w-full rounded-2xl p-4" placeholder="e.g. 12th Main, Indiranagar">
                        </div>

                        <div class="md:col-span-2 space-y-2">
                            <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Landmark</label>
                            <input type="text" name="landmark" 
                                   class="input-field w-full rounded-2xl p-4" placeholder="e.g. Opposite to Apollo Pharmacy">
                        </div>

                        <div class="space-y-2">
                            <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">City</label>
                            <input type="text" name="city" value="Bangalore" readonly 
                                   class="input-field w-full rounded-2xl p-4 opacity-60 pointer-events-none">
                        </div>
                       <div class="space-y-2 group">
    <label class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">
        Pincode <span class="text-orange-500">*</span>
    </label>
    <input type="text" 
           id="pincode"
           name="pincode" 
           pattern="^(5600[0-9]{2}|562[0-9]{3})$" 
           maxlength="6" 
           required 
           class="input-field w-full rounded-2xl p-4 peer" 
           placeholder="560XXX">
    
    <p class="mt-2 hidden peer-invalid:block text-[10px] text-orange-500 font-medium ml-2 uppercase tracking-wide">
        ⚠ Sorry, we currently only provide service in Bangalore.
    </p>
</div>
                    </div>
                </div>

                <button type="submit" class="group relative w-full overflow-hidden rounded-[1.5rem] p-6 font-bold transition-all hover:scale-[1.01] active:scale-[0.98]">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600 to-orange-600 transition-all"></div>
                    <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-10 transition-opacity"></div>
                    <span class="relative flex items-center justify-center text-lg text-white">
                        Confirm {{ service|title }} Booking
                        <svg class="w-6 h-6 ml-3 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    </span>
                </button>
                
                <div class="flex items-center justify-center space-x-4 text-gray-500">
                    <div class="h-px w-8 bg-gray-800"></div>
                    <p class="text-[10px] uppercase tracking-[0.2em]">End-to-End Encryption Secured</p>
                    <div class="h-px w-8 bg-gray-800"></div>
                </div>
            </div>
        </form>
    </div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('booking_date');
    const container = document.getElementById('time-slots-container');
    const hiddenInput = document.getElementById('selected_hour');
    const warning = document.getElementById('time-warning');

    const now = new Date();
    const todayStr = now.toISOString().split('T')[0];
    dateInput.setAttribute('min', todayStr);
    dateInput.value = todayStr;

    function updateTimePills() {
        const selectedDate = dateInput.value;
        const isToday = (selectedDate === todayStr);
        const currentHour24 = now.getHours();

        container.innerHTML = ''; // Clear previous pills
        hiddenInput.value = '';   // Reset selection
        
        const businessHours = [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22];
        let slotsAdded = 0;

        businessHours.forEach(h => {
            // Block past hours if date is today
            if (isToday && h <= currentHour24) return;

            slotsAdded++;
            let displayHour = h > 12 ? h - 12 : h;
            let displayPeriod = h >= 12 ? 'PM' : 'AM';
            if (h === 12) displayPeriod = 'PM';

            // Create the Pill
            const pill = document.createElement('div');
            pill.textContent = `${displayHour} ${displayPeriod}`;
            pill.className = "cursor-pointer border border-white/10 bg-white/5 rounded-xl py-3 text-center text-xs font-medium transition-all hover:border-blue-500/50 hover:bg-blue-500/10";
            
            pill.onclick = function() {
                // Remove active style from all pills
                document.querySelectorAll('#time-slots-container div').forEach(el => {
                    el.classList.remove('border-blue-500', 'bg-blue-500/20', 'text-blue-400');
                });
                // Add active style to this pill
                pill.classList.add('border-blue-500', 'bg-blue-500/20', 'text-blue-400');
                // Set the value for Django
                hiddenInput.value = h;
            };

            container.appendChild(pill);
        });

        warning.classList.toggle('hidden', slotsAdded > 0);
    }

    dateInput.addEventListener('change', updateTimePills);
    updateTimePills(); // Initial run
});
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Find all toast notifications
        const toasts = document.querySelectorAll('.toast-card');
        
        toasts.forEach(toast => {
            // Automatically start fade out after 5 seconds
            setTimeout(() => {
                toast.classList.add('fade-out');
                // Remove element from DOM after animation finishes
                setTimeout(() => {
                    toast.remove();
                }, 500);
            }, 5000);
        });
    });
</script>
</body>
</html>